{
   "$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion":"1.0.0.0",
   "parameters":{
      "vmName":{
         "type":"string"
      },
      "xapLookupLocators":{
         "type":"string"
      },
      "xapLicense":{
         "type":"securestring"
      },
      "gscCount":{
         "type":"int",
         "defaultValue":1
      },
      "publicIP":{
         "type":"string",
         "defaultValue":""
      },
      "privateIP":{
         "type":"string",
         "defaultValue":""
      }
   },
   "variables":{},
   "resources":[
      {
         "type":"Microsoft.Compute/virtualMachines/extensions",
         "name":"[concat(parameters('vmName'), '/', 'XapComputeNodeExtension')]",
         "apiVersion":"2015-06-15",
         "location":"[resourceGroup().location]",
         "dependsOn":[],
         "properties":{
            "publisher":"Microsoft.Azure.Extensions",
            "type":"CustomScript",
            "typeHandlerVersion":"2.0",
            "autoUpgradeMinorVersion":true,
            "settings":{
               "fileUris":[
                  "https://api.github.com/repos/xap/xap-docker/zipball"
               ],
               "commandToExecute":"[concat('sudo /bin/bash -c \"apt-get install unzip; unzip -jo zipball; /bin/bash start-compute-node.sh -n ', parameters('vmName'),' -lic ', parameters('xapLicense'), ' -l ', parameters('xapLookupLocators'), ' -gsc ', parameters('gscCount'), '\"')]"
            }
         }
      }
   ],
   "outputs":{
      "result":{
         "type":"string",
         "value":""
      }
   }
}